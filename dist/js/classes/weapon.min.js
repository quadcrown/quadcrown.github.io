var WEAPONTYPE={MACE:0,SWORD:1,DAGGER:2,AXE:3,FIST:4,POLEARM:5,STAFF:6,FISHINGPOLE:7,MACE_1H:10,SWORD_1H:11,AXE_1H:13,MACE_2H:20,SWORD_2H:21,AXE_2H:23};class Weapon{constructor(player,item,enchant,tempenchant,offhand,twohand){if(this.player=player,this.id=item.id,this.name=item.name,this.mindmg=item.mindmg,this.maxdmg=item.maxdmg,this.basemindmg=item.mindmg,this.basemaxdmg=item.maxdmg,this.type=item.type,this.modifier=offhand?.5*(1+player.talents.offmod)*(1+player.talents.onemod):1+player.talents.onemod,twohand&&(this.modifier=1+player.talents.twomod),this.speed=item.speed,this.timer=0,this.normSpeed=2.4,this.offhand=offhand,this.twohand=twohand,this.crit=0,this.arp=0,this.basebonusdmg=0,this.bonusdmg=0,this.type=WEAPONTYPE[item.type.replace(" ","").toUpperCase()]||0,this.totaldmg=0,this.totalprocdmg=0,this.data=[0,0,0,0,0],this.type==WEAPONTYPE.AXE&&(this.crit+=player.talents.axecrit),this.type==WEAPONTYPE.MACE&&(this.arp+=player.talents.macearp*this.player.level*0.5),this.type==WEAPONTYPE.DAGGER&&(this.normSpeed=1.7),this.twohand&&(this.normSpeed=3.3),item.proc){if(this.proc1={},this.proc1.chance=item.proc.chance?100*item.proc.chance:~~(item.speed*(item.proc.ppm||1)/.006),item.proc.dmg&&!item.proc.magic&&(this.proc1.physdmg=item.proc.dmg),item.proc.dmg&&item.proc.magic&&(this.proc1.magicdmg=item.proc.dmg),item.proc.binaryspell&&(this.proc1.binaryspell=!0),item.proc.coeff&&(this.proc1.coeff=parseInt(item.proc.coeff)),item.proc.procgcd&&(this.proc1.gcd=item.proc.procgcd),item.proc.extra&&(this.proc1.extra=item.proc.extra),!item.proc.dmg||item.proc.magic||item.proc.tick||231848==item.id||(this.proc1.phantom=!0),item.proc.tick&&!item.proc.bleed){let e=parseInt(item.proc.duration)/parseInt(item.proc.interval);item.proc.magic?this.proc1.magicdmg=(item.proc.dmg||0)+item.proc.tick*e:this.proc1.physdmg=(item.proc.dmg||0)+item.proc.tick*e}item.proc.tick&&item.proc.bleed&&(player.auras["weaponbleed"+(this.offhand?"oh":"mh")]=new WeaponBleed(player,0,item.proc.duration,item.proc.interval,item.proc.tick,this.offhand),this.proc1.spell=player.auras["weaponbleed"+(this.offhand?"oh":"mh")]),item.proc.spell&&(player.auras[item.proc.spell.toLowerCase()]||(player.auras[item.proc.spell.toLowerCase()]=eval("new "+item.proc.spell+"(player)")),this.proc1.spell=player.auras[item.proc.spell.toLowerCase()])}enchant&&(enchant.ppm||enchant.chance)&&(this.proc2={},enchant.ppm&&(this.proc2.chance=~~(this.speed*enchant.ppm/.006)),enchant.chance&&(this.proc2.chance=100*enchant.chance),enchant.magicdmg&&(this.proc2.magicdmg=enchant.magicdmg),enchant.procspell&&!offhand&&(player.auras.crusader1=new Crusader(player),player.auras.crusader1.name="Crusader (MH)",this.proc2.spell=player.auras.crusader1),enchant.procspell&&offhand&&(player.auras.crusader2=new Crusader(player),player.auras.crusader2.name="Crusader (OH)",this.proc2.spell=player.auras.crusader2));for(let e of buffs)"windfury"==e.group&&e.active&&(this.player.auras.windfury||this.offhand||(this.player.auras.windfury=new Windfury(this.player,e.id),this.windfury=this.player.auras.windfury));this.windfury||this.proc2||!tempenchant||!tempenchant.ppm&&!tempenchant.chance||(this.proc2={},tempenchant.ppm&&(this.proc2.chance=~~(this.speed*tempenchant.ppm/.006)),tempenchant.chance&&(this.proc2.chance=100*tempenchant.chance),tempenchant.magicdmg&&(this.proc2.magicdmg=tempenchant.magicdmg));for(let e of buffs)e.bonusdmg&&e.active&&(this.basebonusdmg+=e.bonusdmg);enchant&&enchant.bonusdmg&&(this.basebonusdmg+=enchant.bonusdmg),!this.windfury&&tempenchant&&tempenchant.bonusdmg&&(this.basebonusdmg+=tempenchant.bonusdmg),this.bonusdmg=this.basebonusdmg}dmg(e){let t,a=1;return t=rng(this.mindmg+this.bonusdmg,this.maxdmg+this.bonusdmg)+this.player.stats.ap/14*this.speed+this.player.stats.moddmgdone,e&&(t+=e.bonus),e&&this.player.heroicbonus&&(a=1.25),t*this.modifier*this.player.stats.dmgmod*a+this.player.stats.moddmgtaken}avgdmg(){let e=(this.mindmg+this.bonusdmg+this.maxdmg+this.bonusdmg)/2+this.player.stats.ap/14*this.normSpeed+this.player.stats.moddmgdone;return(e=e*this.modifier*this.player.stats.dmgmod+this.player.stats.moddmgtaken)*(1-this.player.armorReduction)}use(){this.timer=Math.round(1e3*this.speed/this.player.stats.haste),!this.offhand&&this.player.spells.slam&&this.player.spells.slam.afterswing&&(this.player.spells.slam.mhthreshold=this.timer-1e3)}step(e){this.timer-=e}}
